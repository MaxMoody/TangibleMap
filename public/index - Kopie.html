<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
    </head>

    <body>
        yPin<input type="text" id= "yPIN" value="3">
        xPin<input type="text" id= "xPIN" value="3">
        Winkel <input id = "angle_txt" type = "text" value="90" min="0" max="170">
        
        <p><input type="file" id="file-input"></p>
            <button onclick="myFunction()">CLICK!!!</button>
        <div style="background-color:LightGray">
            Ergebnis:<ul id="Result" ></ul>
<br>
        </div>
        <div>
        <img id="img" src="">

        </div>
        
        <!--    <script src="color-thief.js"></script>-->
        <script src="https://code.jquery.com/jquery-2.1.3.js"></script>
        <script src="js/load-image.all.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
	<script src="/js/client.js"  type="text/javascript" ></script>
	<script>
            console.log("Starte Skript");
            
            var myFunction = function () {
                var img = document.getElementById("img");
                //console.log(img)
                //console.log(img)
                imgData = new CanvasImage(img);
                console.log(imgData.getImageData().data)
                var imagematrixGroß = new Array;
                var imagematrixKlein2 = new Array;
                var imagematrixGroß2 = new Array;
                var imagematrixKlein = new Array;
                var pixelArray = [];
                var pixels = imgData.getImageData().data;
                for (var p = 0, offset, r, g, b, a; p < pixels.length; p = p + 4) {
                    r = pixels[p + 0];
                    g = pixels[p + 1];
                    b = pixels[p + 2];
                    a = pixels[p + 3];
                    // If pixel is mostly opaque and not white
                    var string = r + "," + g + "," + b;
                    // If pixel is mostly opaque and not white
                    pixelArray.push(string);
                    /*
                    if (a >= 125) {
                    		if (!(r > 250 && g > 250 && b > 250)) {
                    			pixelArray.push(string);
                    		}
                    	}
                        
                        */
                }
                
                var p = 1;
                
                var xPin = document.getElementById("xPIN").value;
                var yPin = document.getElementById("yPIN").value;
                for (var iiii = 0; iiii < yPin; iiii++) {
                    if (iiii == 0) {
                        var start = Math.round(iiii * (img.width * (img.height / xPin)))
                    }
                    for (var iii = 0; iii < xPin; iii++) {
                        var start2 = Math.round(start + (iii * (img.width / yPin)))

                        for (var ii = 0; ii < Math.round((img.height / xPin)); ii++) {
                            var start3 = Math.round((ii * (img.width)) + start2)
                            var max = Math.round(start3 + img.width / yPin);
                            for (var i = start3; i < max; i++) {
                                imagematrixKlein.push(pixelArray[i])
                            }
                        }
                        
                        var result = maxColor(imagematrixKlein)
                        var color = result[0]
                        var verhältnis = result[1]
                        $("#Result").append('<li style="width:400px"> Höchstfarbe='+color+' mit ' + verhältnis + '% </li>');
                        $('li').last().css('background-color', 'rgb('+color+')');
                        //$('li').last().css("width", "100");

                        
                        //$("#Result").css({color: rgb(result)})
                                         
                        imagematrixGroß.push(color)
                        var imagematrixKlein = new Array;
                    }
                    start = i;
                }
                
                console.log(imagematrixGroß)
                
                
            };

        </script>
        <script>
            var CanvasImage = function (image) {
                this.canvas = document.createElement('canvas');
                this.context = this.canvas.getContext('2d');
                document.body.appendChild(this.canvas);
                this.width = this.canvas.width = image.width;
                this.height = this.canvas.height = image.height;
                this.context.drawImage(image, 0, 0, this.width, this.height);
                document.getElementById('img').innerHTML="";
            };
            CanvasImage.prototype.clear = function () {
                this.context.clearRect(0, 0, this.width, this.height);
            };
            CanvasImage.prototype.update = function (imageData) {
                this.context.putImageData(imageData, 0, 0);
            };
            CanvasImage.prototype.getPixelCount = function () {
                return this.width * this.height;
            };
            CanvasImage.prototype.getImageData = function () {
                return this.context.getImageData(0, 0, this.width, this.height);
            };
            CanvasImage.prototype.removeCanvas = function () {
                this.canvas.parentNode.removeChild(this.canvas);
            };

        </script>
        <script>
            var maxColor = function (colorArray) {
                var z = 0;
                var a = 0;
                var pixelArray = colorArray;
                var anzahlimageMatrix = new Array;
                var imagematrixKlein = new Array;
                for (var x = 0; x < pixelArray.length; x++) {
                    a = imagematrixKlein.indexOf(pixelArray[x]);
                    if (a === -1) {
                        imagematrixKlein.push(pixelArray[x]);
                        anzahlimageMatrix.push(1);
                    } else {

                        anzahlimageMatrix[a] = anzahlimageMatrix[a] + 1;
           
                        if (anzahlimageMatrix[a] >= (pixelArray.length / 2)) {
                            console.log("mehr als 50%")
                            
                        return [imagematrixKlein[a],">= 50"];
            
                        }
                                 }
                    if (a > imagematrixKlein.length) {
                        console.log("HIER!!!!")
                    }
                }
                var HöchsteZahl = Math.max(...anzahlimageMatrix)
                var r = anzahlimageMatrix.indexOf(HöchsteZahl);
                //console.log("An der stelle mit der Höchsten anzahl von " + HöchsteZahl +" von " + pixelArray.length + " ist die Farbe " + imagematrixKlein[r]);
                var verhältnis = Math.round((anzahlimageMatrix[r]/colorArray.length)*100)
                return [imagematrixKlein[r],verhältnis];
            }

        </script>
    <script>

		var fileInput = document.getElementById('file-input');
		var fileDisplayArea = document.getElementById('img');


		fileInput.addEventListener('change', function(e) {
			var file = fileInput.files[0];
			var imageType = /image.*/;

			if (file.type.match(imageType)) {
				var reader = new FileReader();

				reader.onload = function(e) {
					fileDisplayArea.src = reader.result;
                    fileDisplayArea.id = "img";

					//fileDisplayArea.appendChild(img);
				}

				reader.readAsDataURL(file);	
			} else {
				fileDisplayArea.innerHTML = "File not supported!"
			}
		});



    </script>
	<script>
  
        

    

        
        </script>
    </body>

</html>
